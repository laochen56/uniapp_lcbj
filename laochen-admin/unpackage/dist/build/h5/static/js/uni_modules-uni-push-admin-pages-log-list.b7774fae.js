(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["uni_modules-uni-push-admin-pages-log-list"],{"185f":function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return n}));var n={downloadExcel:a("0305").default,unicloudDb:a("960d").default,uniTable:a("7dfe").default,uniTr:a("31d4").default,uniTh:a("d6c2").default,uniTd:a("6999").default,uniDateformat:a("3cb4").default,uniDataPicker:a("6f7b").default,uniPagination:a("bd36").default},i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",[a("v-uni-view",{staticClass:"uni-header"},[a("v-uni-view",{staticClass:"uni-group"},[a("v-uni-view",{staticClass:"uni-title"}),a("v-uni-view",{staticClass:"uni-sub-title"})],1),a("v-uni-view",{staticClass:"uni-group"},[a("v-uni-input",{staticClass:"uni-search",attrs:{type:"text",placeholder:"请输入搜索内容"},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.search.apply(void 0,arguments)}},model:{value:e.query,callback:function(t){e.query=t},expression:"query"}}),a("v-uni-button",{staticClass:"uni-button",attrs:{type:"default",size:"mini"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.search.apply(void 0,arguments)}}},[e._v("搜索")]),a("v-uni-button",{staticClass:"uni-button",attrs:{type:"default",size:"mini",disabled:!e.selectedIndexs.length},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.delTable.apply(void 0,arguments)}}},[e._v("批量删除")]),a("download-excel",{staticClass:"hide-on-phone",attrs:{fields:e.exportExcel.fields,data:e.exportExcelData,type:e.exportExcel.type,name:e.exportExcel.filename}},[a("v-uni-button",{staticClass:"uni-button",attrs:{type:"primary",size:"mini"}},[e._v("导出 Excel")])],1)],1)],1),a("v-uni-view",{staticClass:"uni-container"},[a("unicloud-db",{ref:"udb",attrs:{collection:e.collectionList,field:"report,title,creat_time,audience_type,audience_value,platform,state,payload,appId,taskid,msg_num,target_num,receive_num,display_num,click_num,operator_id{username}",where:e.where,"page-data":"replace",orderby:e.orderby,getcount:!0,"page-size":e.options.pageSize,"page-current":e.options.pageCurrent,options:e.options,loadtime:"manual"},on:{load:function(t){arguments[0]=t=e.$handleEvent(t),e.onqueryload.apply(void 0,arguments)}},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data,i=t.pagination,r=t.loading,l=t.error,u=t.options;return[a("uni-table",{ref:"table",attrs:{loading:r,emptyText:l.message||"没有更多数据",border:!0,stripe:!0,type:"selection"},on:{"selection-change":function(t){arguments[0]=t=e.$handleEvent(t),e.selectionChange.apply(void 0,arguments)}}},[a("uni-tr",[a("uni-th",{attrs:{align:"center"}},[e._v("操作员")]),a("uni-th",{attrs:{align:"center",sortable:!0},on:{"sort-change":function(t){arguments[0]=t=e.$handleEvent(t),e.sortChange(t,"title")}}},[e._v("通知栏标题")]),a("uni-th",{attrs:{align:"center","filter-type":"timestamp",sortable:!0},on:{"filter-change":function(t){arguments[0]=t=e.$handleEvent(t),e.filterChange(t,"creat_time")},"sort-change":function(t){arguments[0]=t=e.$handleEvent(t),e.sortChange(t,"creat_time")}}},[e._v("推送时间")]),a("uni-th",{attrs:{align:"center","filter-type":"select","filter-data":u.filterData.audience_type_localdata},on:{"filter-change":function(t){arguments[0]=t=e.$handleEvent(t),e.filterChange(t,"audience_type")}}},[e._v("发送目标")]),a("uni-th",{attrs:{align:"center","filter-type":"select","filter-data":u.filterData.platform_localdata},on:{"filter-change":function(t){arguments[0]=t=e.$handleEvent(t),e.filterChange(t,"platform")}}},[e._v("目标平台")]),a("uni-th",{attrs:{align:"center","filter-type":"search"},on:{"filter-change":function(t){arguments[0]=t=e.$handleEvent(t),e.filterChange(t,"appId")},"sort-change":function(t){arguments[0]=t=e.$handleEvent(t),e.sortChange(t,"appId")}}},[e._v("应用的id")]),a("uni-th",{attrs:{align:"center"}},[e._v("目标设备数")]),a("uni-th",{attrs:{align:"center"}},[e._v("成功下发数")]),a("uni-th",{attrs:{align:"center"}},[e._v("成功接收数（比例）")]),a("uni-th",{attrs:{align:"center"}},[e._v("消息展示数（比例）")]),a("uni-th",{attrs:{align:"center"}},[e._v("消息点击数（比例）")]),a("uni-th",{attrs:{align:"center"}},[e._v("操作")])],1),e._l(n,(function(t,n){return a("uni-tr",{key:n},[a("uni-td",{attrs:{align:"center"}},[e._v(e._s(t.operator_id[0]?t.operator_id[0].username:"-"))]),a("uni-td",{attrs:{align:"center"}},[e._v(e._s(t.title))]),a("uni-td",{attrs:{align:"center"}},[a("uni-dateformat",{attrs:{threshold:[0,0],date:t.creat_time}})],1),a("uni-td",{attrs:{align:"center"}},[e._v("根据"+e._s(u.audience_type_valuetotext[t.audience_type]))]),a("uni-td",{attrs:{align:"center"}},["ALL"==t.platform?a("v-uni-text",[e._v("所有平台")]):a("uni-data-picker",{attrs:{localdata:u.platform_valuetotext,value:t.platform,border:!1,readonly:!0,split:","}})],1),a("uni-td",{attrs:{align:"center"}},[e._v(e._s(t.appId))]),a("uni-td",{attrs:{align:"center"}},[e._v(e._s(t.report?t.report.total.msg_num:"-"))]),a("uni-td",{attrs:{align:"center"}},[e._v(e._s(t.report?t.report.total.target_num+"，（"+parseInt(t.report.total.target_num/t.report.total.msg_num*100)+"%）":"-"))]),a("uni-td",{attrs:{align:"center"}},[e._v(e._s(t.report?t.report.total.receive_num+"，（"+parseInt(t.report.total.receive_num/t.report.total.msg_num*100)+"%）":"-"))]),a("uni-td",{attrs:{align:"center"}},[e._v(e._s(t.report?t.report.total.display_num+"，（"+parseInt(t.report.total.display_num/t.report.total.msg_num*100)+"%）":"-"))]),a("uni-td",{attrs:{align:"center"}},[e._v(e._s(t.report?t.report.total.click_num+"，（"+parseInt(t.report.total.click_num/t.report.total.msg_num*100)+"%）":"-"))]),a("uni-td",{attrs:{align:"center"}},[a("v-uni-view",{staticClass:"uni-group"},[a("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"primary"},on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.navigateTo("./detail?data="+encodeURIComponent(JSON.stringify(t)),!1)}}},[e._v("详情")]),a("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"warn"},on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.confirmDelete(t._id)}}},[e._v("删除")])],1)],1)],1)}))],2),a("v-uni-view",{staticClass:"uni-pagination-box"},[a("uni-pagination",{attrs:{"show-icon":!0,"page-size":i.size,total:i.count},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.onPageChanged.apply(void 0,arguments)}},model:{value:i.current,callback:function(t){e.$set(i,"current",t)},expression:"pagination.current"}})],1)]}}])})],1)],1)},r=[]},"355d":function(e,t,a){"use strict";a.r(t);var n=a("c971"),i=a.n(n);for(var r in n)"default"!==r&&function(e){a.d(t,e,(function(){return n[e]}))}(r);t["default"]=i.a},"6eb7":function(e,t,a){"use strict";a.r(t);var n=a("185f"),i=a("355d");for(var r in i)"default"!==r&&function(e){a.d(t,e,(function(){return i[e]}))}(r);var l,u=a("f0c5"),o=Object(u["a"])(i["default"],n["b"],n["c"],!1,null,"01f50233",null,!1,n["a"],l);t["default"]=o.exports},a993:function(e,t,a){"use strict";var n=a("4ea4");a("4d63"),a("ac1f"),a("25f0"),Object.defineProperty(t,"__esModule",{value:!0}),t.filterToWhere=o,t.enumConverter=t.validator=void 0;var i=n(a("3835")),r=n(a("b85c")),l={title:{rules:[],label:"通知标题"},subtitle:{rules:[],label:"副标题"},audience_type:{rules:[{format:"string"},{range:[{text:"所有用户",value:"ALL"},{text:"指定用户ID",value:"user_id"},{text:"指定用户标签",value:"custom_tag"},{text:"客户端标识",value:"cid"}]}],label:"目标用户"},audience_value:{rules:[],label:"目标用户标识"},platform:{rules:[{format:"array"},{range:[{text:"小程序和H5",value:"web"},{text:"iOS",value:"ios"},{text:"Android",value:"android"}]}],label:"目标平台"},state:{rules:[],label:"推送状态"},channel:{rules:[],label:"渠道id"},url:{rules:[{format:"url"}],label:"点击打开链接"},payload:{rules:[],label:"消息内容"},badge:{rules:[],label:"角标值"},sound:{rules:[{format:"string"}],label:"铃声文件名"},content_available:{rules:[],label:"消息类型（仅iOS支持）"},appid:{rules:[{format:"string"}],label:"应用的id"},taskid:{rules:[{format:"string"}],label:"任务id"},msg_num:{rules:[{format:"int"}],label:"消息可下发数"},target_num:{rules:[{format:"int"}],label:"消息下发数"},receive_num:{rules:[{format:"int"}],label:"消息接收数"},display_num:{rules:[{format:"int"}],label:"消息展示数"},click_num:{rules:[{format:"int"}],label:"消息点击数"}};t.validator=l;var u={audience_type_valuetotext:{ALL:"所有用户",user_id:"用户ID",user_tag:"用户标签",device_id:"设备id",push_clientid:"个推客户端id",getui_custom_tag:"个推自定义客户端标签"},platform_valuetotext:[{text:"小程序和H5",value:"web"},{text:"iOS",value:"ios"},{text:"Android",value:"android"}]};function o(e,t){var a={};for(var n in e){var l=e[n],u=l.type,o=l.value;switch(u){case"search":"string"===typeof o&&o.length&&(a[n]=new RegExp(o));break;case"select":if(o.length){var s,c=[],d=(0,r.default)(o);try{for(d.s();!(s=d.n()).done;){var p=s.value;c.push(t.eq(p))}}catch(w){d.e(w)}finally{d.f()}a[n]=t.or(c)}break;case"range":if(o.length){var f=o[0],v=o[1];a[n]=t.and([t.gte(f),t.lte(v)])}break;case"date":if(o.length){var h=(0,i.default)(o,2),g=h[0],m=h[1],_=new Date(g),b=new Date(m);a[n]=t.and([t.gte(_),t.lte(b)])}break;case"timestamp":if(o.length){var x=(0,i.default)(o,2),y=x[0],k=x[1];a[n]=t.and([t.gte(y),t.lte(k)])}break}}return a}t.enumConverter=u},c971:function(e,t,a){"use strict";(function(e){var n=a("4ea4");a("4de4"),a("4160"),a("d81d"),a("b64b"),a("d3b7"),a("4d63"),a("ac1f"),a("25f0"),a("3ca3"),a("498a"),a("159b"),a("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("96cf");var i=n(a("1da1")),r=n(a("5530")),l=a("a993"),u=e.database(),o="creat_time desc",s=[],c=20,d=1,p={ascending:"asc",descending:"desc"},f={data:function(){return{collectionList:"uni-push-log,uni-id-users",query:"",where:"",orderby:o,orderByFieldName:"",selectedIndexs:[],options:(0,r.default)({pageSize:c,pageCurrent:d,filterData:{audience_type_localdata:[{text:"所有用户",value:"ALL"},{text:"用户id",value:"user_id"},{text:"用户标签",value:"user_tag"},{text:"设备id",value:"device_id"},{text:"个推客户端id",value:"push_clientid"},{text:"个推自定义客户端标签",value:"getui_custom_tag"}],platform_localdata:[{text:"全部",value:"ALL"},{text:"网页端",value:"web"},{text:"App-iOS",value:"app-ios"},{text:"App-Android",value:"app-android"},{text:"微信小程序",value:"mp-weixin"},{text:"360小程序",value:"mp-360"},{text:"百度小程序",value:"mp-baidu"},{text:"支付宝小程序",value:"mp-alipay"},{text:"字节跳动小程序",value:"mp-toutiao"},{text:"QQ小程序",value:"mp-qq"},{text:"快应用联盟",value:"quickapp-webview-union"},{text:"快应用华为",value:"quickapp-webview-huawei"},{text:"快手小程序",value:"mp-kuaishou"},{text:"飞书小程序",value:"mp-lark"},{text:"京东小程序",value:"mp-jd"}]}},l.enumConverter),imageStyles:{width:64,height:64},exportExcel:{filename:"uni-push-log.xls",type:"xls",fields:{"通知标题":"title","推送时间":"creat_time","目标用户":"audience_type","目标用户标识":"audience_value","目标平台":"platform","推送状态":"state","消息内容":"payload","应用的id":"appId","任务id":"taskid","消息可下发数":"msg_num","消息下发数":"target_num","消息接收数":"receive_num","消息展示数":"display_num","消息点击数":"click_num"}},exportExcelData:[]}},onLoad:function(){this._filter={}},onReady:function(){this.$refs.udb.loadData()},methods:{onqueryload:function(t){var a=this;return(0,i.default)(regeneratorRuntime.mark((function n(){var i,r,l,o,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:i=e.importObject("uni-push-co"),r={},t.forEach((function(e){r[e.appId]?r[e.appId].push(e):r[e.appId]=[e]})),l=regeneratorRuntime.mark((function e(a){var n,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r[a].map((function(e){return e.taskid})),e.next=3,i.getReport({appId:a,taskid:n});case 3:if(l=e.sent,l.data){e.next=7;break}return e.abrupt("return","continue");case 7:t.forEach((function(e){l.data[e.taskid]&&(e.report&&v(e.report,l.data[e.taskid])||(e.report=l.data[e.taskid],u.collection("uni-push-log").doc(e._id).update({report:e.report}).then((function(e){}))))}));case 8:case"end":return e.stop()}}),e)})),n.t0=regeneratorRuntime.keys(r);case 5:if((n.t1=n.t0()).done){n.next=13;break}return o=n.t1.value,n.delegateYield(l(o),"t2",8);case 8:if(s=n.t2,"continue"!==s){n.next=11;break}return n.abrupt("continue",5);case 11:n.next=5;break;case 13:a.$set(t,t),a.exportExcelData=t;case 15:case"end":return n.stop()}}),n)})))()},getWhere:function(){var e=this.query.trim();if(!e)return"";var t=new RegExp(e,"i");return s.map((function(e){return t+".test("+e+")"})).join(" || ")},search:function(){var e=this,t=this.getWhere();this.where=t,this.$nextTick((function(){e.loadData()}))},loadData:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$refs.udb.loadData({clear:e})},onPageChanged:function(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo:function(e,t){var a=this;uni.navigateTo({url:e,events:{refreshData:function(){a.loadData(t)}}})},selectedItems:function(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((function(t){return e[t]._id}))},delTable:function(){var e=this;this.$refs.udb.remove(this.selectedItems(),{success:function(t){e.$refs.table.clearSelection()}})},selectionChange:function(e){this.selectedIndexs=e.detail.index},confirmDelete:function(e){var t=this;this.$refs.udb.remove(e,{success:function(e){t.$refs.table.clearSelection()}})},sortChange:function(e,t){var a=this;this.orderByFieldName=t,e.order?this.orderby=t+" "+p[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((function(){a.$refs.udb.loadData()}))},filterChange:function(e,t){var a=this;this._filter[t]={type:e.filterType,value:e.filter};var n=(0,l.filterToWhere)(this._filter,u.command);Object.keys(n).length?this.where=n:this.where="",this.$nextTick((function(){a.$refs.udb.loadData()}))}}};function v(e,t){var a=Object.keys(e);if(a.length!=Object.keys(t).length)return!1;for(var n=0;n<a.length;n++){var i=a[n],r=e[i];if(r!=t[i]){if("object"!=typeof r||"object"!=typeof t[i])return!1;if(!v(r,t[i]))return!1}}return!0}t.default=f}).call(this,a("a9ff")["default"])}}]);